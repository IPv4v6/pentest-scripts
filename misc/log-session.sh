#!/usr/bin/env bash

set -e

if [[ -z ${1} ]]; then
	echo "Usage: ${0} [session name]"
	exit 0
fi

# check for letters, numbers and hyphens
if [[ ${1} =~ ^[a-zA-Z0-9-]+$ ]]; then
	echo "valid session name"
else
	echo "invalid session name"
	exit 1
fi

cat >.screenrc-logsession-${1} <<EOF
startup_message off
logfile screen-%H-%t-%S-%Y-%m-%d_%0c:%s.log
deflog on
defscrollback 1000
hardstatus on
hardstatus alwayslastline "%H / %S / %Y-%m-%d %0c:%s"
EOF

cat >.bashrc-logsession-${1} <<EOF
shopt -s histappend
shopt -s checkwinsize
HISTFILE=.history-logsession-${1}
HISTSIZE=5000
HISTFILESIZE=5000
HISTTIMEFORMAT="%FT%T%z: "
PS1='\`date +%FT%T%z\`|\u@\h\w\\$ '
EOF

screen -S ${1} -c .screenrc-logsession-${1} bash --rcfile .bashrc-logsession-${1}
