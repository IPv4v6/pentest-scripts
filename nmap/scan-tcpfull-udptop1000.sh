#!/usr/bin/env bash

set -e
set -u

(echo -n "Start TCP scans: " && date --rfc-3339=seconds) >> log

for IP in `cat targets`
do
	nmap -vv --stats-every=60s -Pn -sV -O -sS -p1-65535 -oA ${IP}-tcp ${IP}
done

(echo -n "End TCP scans: " && date --rfc-3339=seconds) >> log

(echo -n "Start UDP scans: " && date --rfc-3339=seconds) >> log

for IP in `cat targets`
do
	nmap -vv --stats-every=60s -Pn -sV -O -sU --top-ports=1000 -oA ${IP}-udp-top1000 ${IP}
done

(echo -n "End UDP scans: " && date --rfc-3339=seconds) >> log
